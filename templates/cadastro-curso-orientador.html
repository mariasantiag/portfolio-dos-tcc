<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Curso e Orientador</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="../static/css/cadastro-curso-orientador.css">
  <link rel="stylesheet" href="/static/css/config.css">

  <script src="/static/js/add_orien_curso.js" defer></script>
  <script src="/static/js/delete_orien_curso.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>

  <link rel="icon" type="image/png" href="/static/img/icon__courseregistration.png">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" defer></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body>

  <header class="header__">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col text-center">
          <a href="/paginainicial" class="icone__atalho me-2 d-flex align-items-center">
            <img src="/static/img/icon__atalho.png" alt="icone-atalho-biblioteca" class="img-fluid">
          </a>
          <h1 class="text-white fw-bold titulo__Curso-Orientdor">Cadastro de Curso e Orientador</h1>
        </div>
      </div>
    </div>
  </header>

  <div class="container__cards-curso-orientador">

    <section class="card p-4">
      <div class="tittle">
        <h2> Cadastro De Curso e Orientador </h2>
      </div>

      <form method="POST" action="/post/cadastraorientadorcurso" id="cadastroForm" novalidate>

        <fieldset class="mb-3">
          <legend class="fw-semibold">Curso</legend>
          <div class="mb-3">
            <label for="curso-nome" class="form-label">Nome</label>
            <input type="text" class="form-control" id="curso-nome" name="curso_nome" required>
            <div class="invalid-feedback">Informe o nome do curso.</div>
          </div>
        </fieldset>

        <fieldset class="mb-3">
          <legend class="fw-semibold">Orientadores</legend>

          <div id="orientadores-container">
            <div class="orientador-input mb-2">
              <input type="text" class="form-control" name="orientador_nome" placeholder="Nome do Orientador" required>
            </div>
          </div>

          <button type="button" class="btn btn-sm btn-success mt-2" onclick="adicionarCampo()">+ Adicionar Orientador</button>
        </fieldset>

        <div class="text-center">
          <button type="submit" class="btn btn-primary px-4">Cadastrar</button>
        </div>

      </form>
    </section>

    <section class="card p-4">
      <div class="tittle">
        <h2>Excluir Curso ou Orientador</h2>
      </div>

      <form method="POST" action="/post/excluirorientadorcurso" id="excluirForm" novalidate>

        <fieldset class="mb-3">
          <legend class="fw-semibold">Curso</legend>
          <div class="mb-3">
            <label for="curso-delete" class="form-label">Selecione o Curso</label>
            <select name="curso_delete" id="curso-delete" class="form-select me-2" required>
              <option value="" selected disabled>Selecione o curso</option>
              {% for c in curso %}
              <option value="{{ c.cod_curso }}">{{ c.nome_curso }}</option>
              {% endfor %}
            </select>
          </div>
        </fieldset>

        
        <div class="form-text mb-3">
           - Para excluir um curso, selecione APENAS o curso (isso só funcionará se não houver TCCs cadastrados nele).
         </div>
         
         <div class="text-center">
            <button type="submit" class="btn btn-danger px-4">Excluir</button>
         </div>
         
      </form>

      
   </section>
</div>

<div class="mt-4 mb-5 container__gestaostatus">
  <section class="card p-4 shadow-sm secao_tabela">
    <div class="tittle mb-3">
      <h2>Gestão de Status (Demitir/Contratar)</h2>
    </div>
    
    <div class="alert alert-info" role="alert">
      <i class="bi bi-info-circle-fill"></i> 
      Orientadores "Demitidos" não aparecerão no formulário de novos TCCs, mas seus nomes continuarão visíveis nos projetos feitos.
    </div>

    <div class="table-responsive">
      <table class="table table-hover table-bordered align-middle">
        <thead class="table-dark">
          <tr>
            <th>Orientador</th>
            <th>Curso Vinculado</th>
            <th class="text-center">Status</th>
            <th class="text-center">Ação</th>
          </tr>
        </thead>
        <tbody>
          {% if orientadores %}
            {% for orientador in orientadores %}
            <tr class="{{ 'table-secondary text-muted' if orientador.contratado == 0 else '' }}">
              <td>
                <strong>{{ orientador.nome_orientador }}</strong>
              </td>
              <td>{{ orientador.nome_curso }}</td>
              
              <td class="text-center">
                {% if orientador.contratado == 1 %}
                  <span class="badge bg-success rounded-pill">Contratado</span>
                {% else %}
                  <span class="badge bg-danger rounded-pill">Demitido/Inativo</span>
                {% endif %}
              </td>

              <td class="text-center">
                <form action="/post/alterarstatusorientador" method="POST" style="display: inline;">
                  <input type="hidden" name="cod_orientador" value="{{ orientador.cod_orientador }}">
                  
                  {% if orientador.contratado == 1 %}
                    <button type="submit" name="acao" value="demitir" class="btn btn-outline-danger btn-sm" title="Remover da lista de novos cadastros">
                      <i class="bi bi-person-x-fill"></i> Retirar
                    </button>
                  {% else %}
                    <button type="submit" name="acao" value="contratar" class="btn btn-outline-success btn-sm" title="Tornar visível novamente">
                      <i class="bi bi-person-check-fill"></i> Reativar
                    </button>
                  {% endif %}
                </form>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="4" class="text-center text-muted py-3">Nenhum orientador cadastrado no sistema.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>
</div>

  {% if session.usuario %}
  <div class="add__tcc dropdown__add">
    <i class="bi bi-plus-circle fs-1" role="button" id="dropdownAddButton" data-bs-toggle="dropdown" aria-expanded="false"></i>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAddButton">
      <li><a class="dropdown-item" href="/paginacadastrotcc">Adicionar TCC</a></li>
      <li><a class="dropdown-item" href="/paginahistorico">Histórico</a></li>
    </ul>
  </div>
  {% endif %}


  <script>
    document.addEventListener("DOMContentLoaded", function() {
      {% with messages = get_flashed_messages(with_categories = True) %}
        {% if messages %}
          {% for category, message in messages %}
            {% if category == 'success' %}
              Swal.fire({
                title: 'Sucesso!',
                text: '{{ message }}',
                icon: 'success',
                confirmButtonText: 'OK'
              });
            {% elif category == 'error' %}
              Swal.fire({
                title: 'Erro!',
                text: '{{ message }}',
                icon: 'error',
                confirmButtonText: 'Tentar novamente'
              });
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endwith %}
    });
  </script>

</body>
</html>